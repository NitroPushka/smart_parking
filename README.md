# Smart Parking Detection System

Комплексная система компьютерного зрения для определения занятости парковочных мест в реальном времени с использованием YOLO для детекции объектов и CNN для классификации.

## Основные возможности 
- Детекция транспортных средств в реальном времени на основе YOLO
- Классификация парковочных мест на свободные/занятые с помощью CNN
- Геометрический анализ пересечений с использованием Shapely
- Обработка видеопотоков в реальном времени
- Настраиваемая система через YAML-конфигурацию
- Логирование с ротацией файлов

## Системные требования
- Python 3.8+
- 8GB+ RAM
- Доступ к видеопотоку

## Установка

### Клонирование репозитория
```bash
git clone <repository-url>
cd smart_parking
```

### Создание виртуального окружения
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Загрузка предобученных моделей
```bash
# YOLO модели загружаются автоматически при первом использовании
# Или загрузите вручную:
wget https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8n.pt
wget https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8s.pt
wget https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8m.pt
```
## Стурктура проекта
```
smart_parking/
├── scripts/                          # Основные исполняемые скрипты
│   └── learning/                     # Скрипты обучения и работы с моделями
│       ├── learning_classifier.py    # Обучение классификатора
│       ├── yolo_detector.py          # Детекция YOLO
│   ├── classifier_live.py            # Классификация парковок
│   └── detect_with_shapely.py        # Детекция с геометрическим анализом
├── data/                             # Данные
│   ├── dataset_parking/              # Датасет для обучения
│   └── cvat_images/                  # Аннотированные изображения
├── models/                           # Обученные модели
├── src/                              # Исходный код модулей
├── venv/                             # Виртуальное окружение
└── requirements.txt                  # Зависимости Python
```
## Быстрый старт

### 1. Обучение моделей

#### Для начала работы необходимо обучить модели в папке scripts/learning/:

```bash
python scripts/learning/learning_classifier.py
```
```bash
python scripts/learning/yolo_detector.py
```

### 2. Запуск готовых решений
```bash
# Запуск live классификации парковочных мест
python scripts/classifier_live.py
```

```bash
# Запуск детекции с геометрическим анализом
python scripts/detect_with_shapely.py
```

## Конфигурация

Система использует конфигурационные файлы `src/utils/config.py` основные настройки и источники, а также `data/dataset_parking/dataset_car_truck/parking.yaml` для настройки параметров обучения YOLO модели.


## Архитектура

### Пайплайн детекции транспортных средств

1. **YOLO детекция**: Детекция транспортных средств в реальном времени
2. **Фильтрация ROI**: Фокусировка на релевантной области парковки
3. **Геометрический анализ**: Расчет пересечений с использованием Shapely
4. **Определение статуса**: Классификация на свободные/занятые

### Пайплайн классификации

1. **Загрузка данных**: PyTorch DataLoader с аугментацией
2. **Обучение CNN**:  Кастомная архитектура с BatchNorm и Dropout
3. **Валидация модели**: Кросс-валидация и отслеживание метрик
4. **Инференс**: Классификация в реальном времени на видеопотоке

## Процесс обучения

1. Валидация данных: Проверка целостности датасета
2. Разделение на train/val: Стратифицированное разделение
3. Аугментация: Горизонтальное отражение, яркость, шум, размытие и другое
4. Цикл обучения: Оптимизатор Adam с регулировкой learning rate
5. Отслеживание метрик: Мониторинг потерь и точности

## Метрики производительности

### Производительность детекции
YOLO mAP@0.5: ~0.95 (автомобили), ~0.86 (грузовики)

### Производительность классификации
Точность обучения: ~90% (train), ~85% (validation)
